package com.dalogin;


import java.io.IOException;
import java.util.concurrent.TimeoutException;
import org.apache.log4j.Logger;
import com.rabbitmq.client.ConnectionFactory;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.Channel;

public class MQConnectionManager {

	public final static String QUEUE_NAME = "hello";
	private String mqURL;

	private static volatile ConnectionFactory factory = null;

	private volatile Channel chanel;
	private volatile Connection connection;
	
	private static Logger log = Logger.getLogger(Logger.class.getName());

	public MQConnectionManager(String url){
		
		this.mqURL=url;
		
	}
		
	public Channel getConnection() throws IOException, TimeoutException {
		
	    factory().setHost(mqURL);
	    connection = factory().newConnection();
	    chanel = connection.createChannel();
	    chanel.queueDeclare(QUEUE_NAME, false, false, false, null);
	    
		log.info("mQ Connection created");

		return this.chanel;
	}
	
	private synchronized static ConnectionFactory factory() {

        if (factory == null) {
    		factory = new ConnectionFactory();
        	}
	  return factory;         
	  }
	
	
}
